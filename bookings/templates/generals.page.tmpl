{{template "base" .}}

{{ define "css"}}

<style>
  .datepicker-picker {
    margin-bottom: 100px;
  }

  .datepicker-dropdown {
    padding-top: 4px;
    position: static;
    z-index: 1000;
  }
</style>

{{ end }}

{{define "content"}}
<!-- CONTAINER -->
<div class="container">
  <div class="row">
    <div class="col">
      <img
        src="/static/images/generals-quarters.png"
        alt="generals room image"
        class="img-fluid mx-auto d-block room-image img-thumbnail"
      />
    </div>
  </div>
  <div class="row">
    <div class="col">
      <h1 class="text-center mt-4">
        General's Quarters
      </h1>
      <p>
        Your home away from home, set on the majestic waters of the atlantic
        Ocean, this will be a vacation to remember
      </p>
    </div>
  </div>

  <div class="row">
    <div class="col text-center">
      <a id="check-availability-button" class="btn btn-success">
        Check Availability</a
      >
    </div>
  </div>
</div>
{{ end }}

{{define "js"}}

<script>
  const button = document.getElementById("check-availability-button");
  button.addEventListener("click", function () {
    let html = `
    <form
        id="check-availability-form"
        action=""
        method="post"
        class="needs-validation"
        novalidate
      >
        <div class="form-row" id="reservation-dates-modal">
          <div class="col">
            <div class="form-row" >

              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  name="start"
                  id="start"
                  placeholder="Arrival"
                  required

                />
              </div>

              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  name="end"
                  id="end"
                  placeholder="Departure"
                  required

                />
              </div>
            </div>
          </div>
        </div>
      </form>`;

    attention.custom({
      msg: html,
      title: "Choose your date",
      willOpen: () => {
        const el = document.getElementById("reservation-dates-modal");
        const rp = new DateRangePicker(el, {
          format: "mm/dd/yyyy",
          showOnFocus: true,
        });
      },
      preConfirm: () => {
        return [
          document.getElementById("start").value,
          document.getElementById("end").value,
        ];
      },
      didOpen: () => {
        document.getElementById("start").removeAttribute("disabled");
        document.getElementById("end").removeAttribute("disabled");
      },

      callback: function (result) {
        let form = document.getElementById("check-availability-form");
        let formData = new FormData(form);
        formData.append("csrf_token", "{{.CSRFToken}}");
        formData.append("room_id", "1");

        console.log("FORM : ", form);
        console.log("FORMDATA : ", formData);

        fetch("/search-availability-json", {
          method: "post",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("DATA : ", data);
            if (data.ok) {
              console.log("room is available");
              attention.custom({
                icon: "success",
                msg:
                  "<p> Room is available</p>" +
                  '<p><a href="/book-room?id=' +
                  data.room_id +
                  "&s=" +
                  data.start_date +
                  "&e=" +
                  data.end_date +
                  '" class="btn btn-primary">Book Now</a></p>',
                showConfirmButton: false,
              });
            } else {
              console.log("room is not available");

              attention.error({
                msg: "No room available",
              });
            }
          });
      },
    });
  });
</script>

{{ end }}
